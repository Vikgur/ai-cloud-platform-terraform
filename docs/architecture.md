# Оглавление

- [Назначение документа](#назначение-документа)
- [Архитектурные принципы](#архитектурные-принципы)
- [Границы доверия](#границы-доверия)
- [Слоистая архитектура платформы](#слоистая-архитектура-платформы)
  - [Cloud слой](#cloud-слой)
  - [Infrastructure слой](#infrastructure-слой)
  - [Kubernetes слой](#kubernetes-слой)
  - [AI слой](#ai-слой)
  - [Governance слой](#governance-слой)
- [Разделение ответственности](#разделение-ответственности)
  - [Provisioning](#provisioning)
  - [Enforcement](#enforcement)
  - [Runtime](#runtime)
  - [Governance](#governance)
- [Архитектурные решения и rationale](#архитектурные-решения-и-rationale)
- [High-level архитектура платформы](#high-level-архитектура-платформы)
  - [Control Plane](#control-plane)
  - [Data Plane](#data-plane)
  - [AI Compute Plane](#ai-compute-plane)
- [Взаимосвязь с другими документами](#взаимосвязь-с-другими-документами)
- [Структура репозитория](#структура-репозитория)
- [Итоговая архитектурная картина](#итоговая-архитектурная-картина)

---

# Назначение документа

`architecture.md` — архитектура платформы.

Документ описывает архитектурный каркас Sovereign AI Cloud Platform:  
принципы проектирования, границы доверия, слоистую модель и архитектурные решения.

Цель документа — показать **как и почему** приняты ключевые архитектурные решения.

Документ читается вместе с:
- `docs/security-model.md` — для понимания угроз и контролов  
- `docs/workflows.md` — для понимания жизненного цикла изменений  
- `docs/data-flows.md` — для понимания движения AI-данных  
- `docs/repository-structure.md` — для понимания назначения каждой директории и файла 

---

# Архитектурные принципы

Архитектура платформы основана на следующих принципах:

- **Platform-first, не project-first**  
  Проектируется платформа, на которой могут жить десятки сервисов и AI-нагрузок.

- **Security by design**  
  Безопасность встроена в архитектуру, а не добавлена поверх.

- **Policy-driven управление**  
  Политики — исполняемый механизм допуска изменений.

- **Минимизация доверия**  
  Отсутствие implicit trust между слоями, окружениями и компонентами.

- **Иммутабельность**  
  Изменения достигаются пересозданием и promotion, а не ручными правками.

- **Auditability**  
  Любое действие оставляет проверяемый след.

---

# Границы доверия

Платформа явно моделирует доверенные и недоверенные зоны.

Основные trust boundaries:

- Между окружениями (`dev` / `stage` / `prod`)
- Между provisioning и runtime
- Между control plane и data plane
- Между AI training и inference
- Между human и non-human доступом

Каждая граница:
- имеет формализованные политики
- защищена enforcement-механизмами
- учитывается в threat model

Границы доверия важнее конкретных технологий.

---

# Слоистая архитектура платформы

Архитектура организована как независимые, но связанные слои.

## Cloud слой

Базовый облачный фундамент:
- сети
- IAM
- compute
- storage
- observability

Слой отвечает за:
- изоляцию
- масштаб
- базовую безопасность

Не содержит бизнес-логики и AI-специфики.

## Infrastructure слой

Terraform-модули, описывающие архитектуру:
- агрегация ресурсов
- повторное использование
- стандартизация

Infrastructure слой:
- не знает об окружениях
- не знает о CI
- не содержит политик допуска

## Kubernetes слой

Отвечает за:
- control plane
- node groups
- CNI
- runtime ограничения

Kubernetes рассматривается как **инфраструктурный примитив**,  
а не как application platform.

## AI слой

Отдельный доверенный контур:
- GPU node pools
- зоны данных
- training / registry / inference

AI слой:
- изолирован от общего compute
- имеет собственные trust boundaries
- управляется через promotion моделей

## Governance слой

Исполняемый слой контроля:
- Policy-as-Code
- audit trail
- exception workflows
- decision logs

Governance не наблюдает — он **запрещает или разрешает**.

---

# Разделение ответственности

Архитектура жёстко разделяет зоны ответственности.

## Provisioning

- Terraform
- создание ресурсов
- отсутствие runtime-доступа

Provisioning не управляет изменениями после apply.

## Enforcement

- OPA
- Checkov
- tfsec
- CI policy gates

Enforcement принимает решения о допустимости изменений.

## Runtime

- Kubernetes
- AI workloads
- autoscaling
- execution среды

Runtime не имеет прав менять инфраструктуру.

## Governance

- контроль процессов
- аудит
- исключения
- соответствие требованиям

Governance не выполняет инфраструктурные операции.

---

# Архитектурные решения и rationale

Ключевые решения:

- Отказ от ресурсов в root Terraform  
  → снижение blast radius

- Изоляция state по окружениям  
  → предотвращение cross-env ошибок

- CI как единственная точка apply  
  → исключение human error

- GPU как отдельный compute-контур  
  → контроль доступа и стоимости

- Policy-as-Code  
  → воспроизводимость governance

Каждое решение принято для снижения системных рисков.

---

# High-level архитектура платформы

Архитектура разделена на три плоскости:

## Control Plane

- Terraform
- CI
- Policies
- Governance

Управляет изменениями, но не обрабатывает данные.

## Data Plane

- Kubernetes workloads
- сервисы
- storage

Не имеет доступа к control plane.

## AI Compute Plane

- GPU-ноды
- training jobs
- inference workloads

Изолирован от общего data plane.

---

# Взаимосвязь с другими документами

- `security-model.md`  
  Описывает угрозы и контролы для каждой границы.

- `workflows.md`  
  Описывает lifecycle изменений и promotion.

- `data-flows.md`  
  Описывает движение AI-данных через trust boundaries.

- `repository-structure.md`  
  Подробное описание структуры репозитория, каталогов и файлов.

---

# Структура репозитория

Структура отражает архитектурные слои, а не Terraform-удобство:

- `global/` — организационный и базовый cloud слой  
- `modules/` — инфраструктурные примитивы  
- `environments/` — параметры окружений  
- `policies/` — enforcement политик  
- `governance/` — контроль и аудит  
- `ai/` — Sovereign AI контур  

Файловая структура подчинена архитектуре, а не наоборот.

Подробное описание структуры репозитория, каталогов и файлов см. в `docs/repository-structure.md`.

---

# Итоговая архитектурная картина

Платформа представляет собой:
- управляемую
- масштабируемую
- аудируемую
- security-first систему

Архитектура рассчитана на рост, ужесточение требований и работу в суверенных средах без пересборки фундамента.
